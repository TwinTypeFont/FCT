const{createApp,ref}=Vue;createApp({setup(){const previewA=ref(null);const previewB=ref(null);return{previewA,previewB}},data(){return{lang:'zh',ui:{title:{zh:'字體對比工具',en:'Font Comparison Tool'},panel:{zh:'控制面板',en:'Control Panel'},testText:{zh:'測試文字',en:'Test Text'},chars:{zh:'字',en:'chars'},shuffle:{zh:'隨機順序',en:'Shuffle'},preset1:{zh:'文本1',en:'Chinese Text'},preset2:{zh:'文本2',en:'English Text'},fontSize:{zh:'字級 (px)',en:'Font Size (px)'},lineHeight:{zh:'行高 (em)',en:'Line Height (em)'},letterSpacing:{zh:'字元間距 (px)',en:'Letter Spacing (px, can be negative)'},blur:{zh:'模糊（px）',en:'Blur (px)'},grayscale:{zh:'灰階檢視',en:'Grayscale'},palette:{zh:'配色',en:'Palette'},fg:{zh:'文字',en:'Foreground'},bg:{zh:'背景',en:'Background'},palette1:{zh:'預設一：Midnight',en:'Preset 1: Midnight'},palette2:{zh:'預設二：Sand',en:'Preset 2: Sand'},palette3:{zh:'預設三：Crimson',en:'Preset 3: Crimson'},paletteRandom:{zh:'隨機配色',en:'Random Palette'},exportA:{zh:'匯出區塊 A',en:'Export Block A'},exportB:{zh:'匯出區塊 B',en:'Export Block B'},previewA:{zh:'預覽 A',en:'Preview A'},uploadA:{zh:'上傳A區字型',en:'Upload Font A'},previewB:{zh:'預覽 B',en:'Preview B'},uploadB:{zh:'上傳字體',en:'Upload Font'},defaultFonts:{zh:'NotoSerifTC-Regular',en:'NotoSerifTC-Regular'},resolution:{zh:'2x 解析度',en:'2x Resolution'}},defaultTexts:['四季遞嬗，日月更迭，唯有筆墨如石堅。','The quick brown fox jumps over the lazy dog.'],text:'',fontSize:32,lineHeight:1.3,letterSpacing:0.0,fg:'#e8eaf0',bg:'#0f1320',blurPx:0,grayscale:false,palettes:{midnight:{fg:'#E8EAF0',bg:'#0F1320'},sand:{fg:'#3A2E1E',bg:'#F3E9D2'},crimson:{fg:'#FDF2F2',bg:'#2B0B0D'}},fontB:'NotoSerifTC',uploadedFonts:[],fontAName:'',uploadedFontsA:[]}},created(){this.text=this.defaultTexts[0]},computed:{filterCss(){return[this.grayscale?'grayscale(1)':'grayscale(0)',`blur(${this.blurPx}px)`].join(' ')},previewStyleA(){let fontName=this.fontAName?this.fontAName:'system-ui';return{fontFamily:`"${fontName}",system-ui,-apple-system,Segoe UI,Helvetica,Arial`,fontSize:this.fontSize+'px',lineHeight:this.lineHeight,letterSpacing:this.letterSpacing+'px',color:this.fg,background:this.bg,filter:this.filterCss}},previewStyleB(){let fontName=this.fontB==='NotoSerifTC'?'NotoSerifTC':this.fontB;return{fontFamily:`"${fontName}",system-ui,-apple-system,Segoe UI,Helvetica,Arial`,fontWeight:'normal',fontSize:this.fontSize+'px',lineHeight:this.lineHeight,letterSpacing:this.letterSpacing+'px',color:this.fg,background:this.bg,filter:this.filterCss}},fontBName(){if(this.fontB==='NotoSerifTC')return'NotoSerifTC-Regular.ttf';return this.fontB}},methods:{shuffleText(){const parts=this.text.split(/\n/).map(line=>line.split('').sort(()=>Math.random()-0.5).join(''));this.text=parts.join('\n')},randomPalette(){const rnd=()=>'#'+Math.floor(Math.random()*0xFFFFFF).toString(16).padStart(6,'0');let bg=rnd(),fg=rnd();const lum=c=>{const r=parseInt(c.slice(1,3),16)/255,g=parseInt(c.slice(3,5),16)/255,b=parseInt(c.slice(5,7),16)/255;const a=[r,g,b].map(v=>v<=0.03928?v/12.92:Math.pow((v+0.055)/1.055,2.4));return 0.2126*a[0]+0.7152*a[1]+0.0722*a[2]};let tries=0;while(Math.abs(lum(bg)-lum(fg))<0.3&&tries++<10)fg=rnd();this.bg=bg;this.fg=fg},applyPalette(key){const p=this.palettes[key];if(!p)return;this.fg=p.fg;this.bg=p.bg},async exportJPG(which){const el=which==='b'?this.$refs.previewB:this.$refs.previewA;if(!el)return;await new Promise(r=>setTimeout(r,50));const canvas=await html2canvas(el,{backgroundColor:null,scale:2,useCORS:true});const name=which==='b'?'preview_B.jpg':'preview_A.jpg';const dataURL=canvas.toDataURL('image/jpeg',0.92);const a=document.createElement('a');a.href=dataURL;a.download=name;document.body.appendChild(a);a.click();a.remove()},handleFontUpload(e){const file=e.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=(ev)=>{const fontData=ev.target.result;const fontName=file.name.replace(/\.[^.]+$/,"");const style=document.createElement('style');style.innerHTML=`@font-face{font-family:'${fontName}';src:url(${fontData});font-display:swap}`;document.head.appendChild(style);if(!this.uploadedFonts.some(f=>f.name===fontName)){this.uploadedFonts.push({name:fontName,data:fontData})}this.fontB=fontName};reader.readAsDataURL(file)},handleFontAUpload(e){const file=e.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=(ev)=>{const fontData=ev.target.result;const fontName=file.name.replace(/\.[^.]+$/,"");const style=document.createElement('style');style.innerHTML=`@font-face{font-family:'${fontName}';src:url(${fontData});font-display:swap}`;document.head.appendChild(style);if(!this.uploadedFontsA.some(f=>f.name===fontName)){this.uploadedFontsA.push({name:fontName,data:fontData})}this.fontAName=fontName};reader.readAsDataURL(file)},setFontA(name){this.fontAName=name}}}).mount('#app');